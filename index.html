<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ElitePro AI | Yusuf Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { 
            --accent: #00f2ff; /* Cyber Cyan */
            --accent-glow: rgba(0, 242, 255, 0.3);
            --bg: #05070a;
            --glass: rgba(15, 18, 25, 0.98);
            --border: rgba(255, 255, 255, 0.1);
            --text: #ececec;
        }

        .light-mode {
            --bg: #f4f7f6;
            --glass: rgba(255, 255, 255, 0.95);
            --border: rgba(0, 0, 0, 0.1);
            --text: #1a1a1a;
            --accent: #007bff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; width: 100vw; overflow: hidden; position: fixed; background: var(--bg); transition: background 0.3s; }
        
        body { display: flex; color: var(--text); }
        
        /* Sidebar */
        .sidebar { width: 280px; background: var(--glass); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; transition: transform 0.3s ease; z-index: 2001; }
        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; z-index: 2000; }
        
        .main { flex: 1; display: flex; flex-direction: column; position: relative; width: 100%; height: 100%; }
        
        .top-nav { height: 60px; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; border-bottom: 1px solid var(--border); z-index: 1; background: var(--glass); }
        .nav-icons { display: flex; gap: 15px; align-items: center; }

        .chat-area { flex: 1; overflow-y: auto; padding: 15px; z-index: 1; scroll-behavior: smooth; }
        .message-wrapper { max-width: 800px; margin: 0 auto; display: flex; flex-direction: column; gap: 20px; }
        
        /* Messages */
        .message { display: flex; gap: 10px; width: 100%; }
        .avatar { width: 34px; height: 34px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 0.9rem; }
        .bot-avatar { background: var(--accent); color: #000; box-shadow: 0 0 10px var(--accent-glow); }
        .user-avatar { background: #555; color: #fff; }
        .text-box { background: rgba(128,128,128,0.1); padding: 12px 16px; border-radius: 15px; border: 1px solid var(--border); flex: 1; font-size: 0.95rem; line-height: 1.5; color: var(--text); }
        
        /* Code Box Fix */
        pre { background: #000 !important; color: #0f0 !important; padding: 15px; border-radius: 8px; overflow-x: auto; margin: 10px 0; border: 1px solid #333; font-family: monospace; white-space: pre-wrap; word-break: break-all; }
        .dl-btn { background: var(--accent); color: #000; border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; margin-top: 10px; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; font-size: 0.8rem; }

        .input-wrap { padding: 15px; z-index: 1; }
        .input-box { max-width: 800px; margin: 0 auto; background: rgba(128,128,128,0.15); border: 1px solid var(--border); padding: 10px 18px; border-radius: 30px; display: flex; align-items: center; gap: 12px; }
        input { flex: 1; background: none; border: none; color: var(--text); outline: none; font-size: 1rem; }
        .send-btn { background: var(--accent); color: #000; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        @media (max-width: 768px) { 
            .sidebar { position: fixed; left: -280px; height: 100%; }
            .sidebar.open { left: 0; }
            .sidebar.open + .sidebar-overlay { display: block; }
        }
    </style>
</head>
<body>
    <aside class="sidebar" id="sidebar">
        <h2 style="color: var(--accent);">ELITEPRO</h2>
        <p style="font-size: 0.7rem; opacity: 0.6; margin-bottom: 20px;">by Yusuf</p>
        <button onclick="location.reload()" style="padding: 12px; border-radius: 15px; border: none; background: var(--accent); color: #000; font-weight: 600; cursor: pointer; width: 100%;">+ New Chat</button>
    </aside>
    <div class="sidebar-overlay" id="overlay" onclick="closeSidebar()"></div>

    <main class="main">
        <nav class="top-nav">
            <button onclick="toggleSidebar()" style="background:none; border:none; color:var(--text); font-size:1.3rem;"><i class="fas fa-bars"></i></button>
            <span style="font-weight: 600; letter-spacing: 1px;">ELITEPRO CHATBOT AI</span>
            <div class="nav-icons">
                <i class="fas fa-moon" id="themeBtn" style="cursor:pointer;" onclick="toggleTheme()"></i>
                <i class="fas fa-volume-up" id="muteIcon" style="cursor:pointer;" onclick="toggleMute()"></i>
            </div>
        </nav>

        <div class="chat-area" id="chatArea" onclick="closeSidebar()"><div class="message-wrapper" id="chatMessages"></div></div>

        <div class="input-wrap">
            <div class="input-box">
                <i class="fas fa-microphone" id="micBtn" style="cursor:pointer; color:var(--accent);"></i>
                <input type="text" id="userInput" placeholder="Ask ElitePro..." autocomplete="off">
                <button class="send-btn" id="sendBtn" onclick="handleSend()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </main>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const chatArea = document.getElementById('chatArea');
        const sidebar = document.getElementById('sidebar');
        const muteIcon = document.getElementById('muteIcon');
        
        let isMuted = false, isBusy = false;

        function toggleSidebar() { sidebar.classList.toggle('open'); }
        function closeSidebar() { sidebar.classList.remove('open'); }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const themeBtn = document.getElementById('themeBtn');
            themeBtn.className = document.body.classList.contains('light-mode') ? 'fas fa-sun' : 'fas fa-moon';
        }

        function toggleMute() {
            isMuted = !isMuted;
            muteIcon.className = isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up';
            if (isMuted) window.speechSynthesis.cancel();
        }

        function formatText(text) {
            let safe = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
            if (text.includes("<!DOCTYPE") || text.includes("<html")) {
                safe += `<br><button class="dl-btn" onclick="downloadCode(\`${btoa(text)}\`)"><i class="fas fa-download"></i> Download HTML</button>`;
            }
            return safe.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                       .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
                       .replace(/\n/g, '<br>');
        }

        function downloadCode(b64) {
            const a = document.createElement('a');
            a.href = 'data:text/html;base64,' + b64;
            a.download = 'ElitePro_Code.html'; a.click();
        }

        function speak(text) {
            if (isMuted) return;
            window.speechSynthesis.cancel();
            const speech = new SpeechSynthesisUtterance(text.replace(/[#*`_-]/g, ''));
            window.speechSynthesis.speak(speech);
        }

        function addMessage(text, isUser, isImage = false) {
            const div = document.createElement('div');
            div.className = 'message';
            const content = isImage ? `<img src="${text}" style="width:100%; border-radius:12px; border:1px solid var(--accent); margin-top:10px;">` : formatText(text);
            
            div.innerHTML = `
                <div class="avatar ${isUser ? 'user-avatar' : 'bot-avatar'}"><i class="fas ${isUser ? 'fa-user' : 'fa-robot'}"></i></div>
                <div class="text-box">${isUser ? text : '<span class="typing"></span>'}</div>
            `;
            chatMessages.appendChild(div);
            
            if (!isUser && !isImage) {
                let i = 0; const target = div.querySelector('.typing');
                const timer = setInterval(() => {
                    if (i < text.length) { target.textContent += text.charAt(i++); chatArea.scrollTop = chatArea.scrollHeight; }
                    else { clearInterval(timer); target.innerHTML = content; speak(text); isBusy = false; }
                }, 10);
            } else if (isImage) { div.querySelector('.text-box').innerHTML = content; isBusy = false; }
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        async function handleSend() {
            const val = userInput.value.trim();
            if (!val || isBusy) return;
            closeSidebar();
            isBusy = true; userInput.value = "";
            addMessage(val, true);

            // Thinking Logic
            const loader = document.createElement('div');
            loader.className = 'message'; loader.id = 'loader';
            loader.innerHTML = `<div class="avatar bot-avatar"><i class="fas fa-robot"></i></div><div class="text-box">ðŸ¤” Thinking...</div>`;
            chatMessages.appendChild(loader);
            chatArea.scrollTop = chatArea.scrollHeight;

            const lowVal = val.toLowerCase();
            
            // Image Generation Logic
            if (lowVal.includes("draw") || lowVal.includes("generate image")) {
                document.getElementById('loader').remove();
                const p = val.replace(/draw|generate image/gi, "").trim();
                addMessage(`https://image.pollinations.ai/prompt/${encodeURIComponent(p)}?nologo=true`, false, true);
                return;
            }

            // HARD-CODED IDENTITY CHECK
            if (lowVal.includes("who are you") || lowVal.includes("your name") || lowVal === "elitepro") {
                document.getElementById('loader').remove();
                addMessage("I am **ElitePro**, your professional AI assistant developed by **Yusuf**. I'm here to help you with coding, creative tasks, and more.", false);
                return;
            }

            try {
                const res = await fetch('https://eliteprotech-apis.zone.id/copilot?q=' + encodeURIComponent(val));
                const data = await res.json();
                document.getElementById('loader').remove();
                // Replace any leaked Copilot/Microsoft names with ElitePro/Yusuf
                let cleanText = data.text.replace(/Copilot/gi, "ElitePro").replace(/Microsoft/gi, "Yusuf's Tech");
                addMessage(cleanText, false);
            } catch {
                document.getElementById('loader').remove();
                addMessage("Connection error. Try again!", false);
                isBusy = false;
            }
        }

        // Speech Recognition
        const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (SpeechRec) {
            const rec = new SpeechRec();
            document.getElementById('micBtn').onclick = () => { rec.start(); document.getElementById('micBtn').style.color = 'red'; };
            rec.onresult = (e) => { userInput.value = e.results[0][0].transcript; handleSend(); };
            rec.onend = () => { document.getElementById('micBtn').style.color = 'var(--accent)'; };
        }

        userInput.onkeypress = (e) => { if(e.key === 'Enter') handleSend(); };
    </script>
</body>
</html>
